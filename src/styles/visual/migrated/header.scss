.header {
  position: sticky;
  top: 0;
  z-index: 100;
  padding: clamp(8px, 0.62vw + 6px, 14px) var(--layout-gutter);
  color: var(--text-primary);
  background: var(--nav-bg);
  border-bottom: none;
  backdrop-filter: blur(14px) saturate(120%);
  -webkit-backdrop-filter: blur(14px) saturate(120%);
  box-shadow: 0 8px 24px rgba(7, 12, 30, 0.18);

  &::before {
    content: "";
    position: absolute;
    inset: 0;
    background: var(--gradient-aurora);
    opacity: 0.38;
    pointer-events: none;
  }

  &__container {
    position: relative;
    width: min(100%, var(--layout-content-max));
    margin-inline: auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: clamp(8px, 0.55vw + 6px, 16px);
  }

  &__left {
    display: flex;
    align-items: center;
    gap: clamp(6px, 0.34vw + 5px, 10px);
    min-width: 0;
  }

  &__brand {
    border: none;
    background: transparent;
    cursor: pointer;
    padding: 0;
    display: inline-flex;
    align-items: center;
    gap: clamp(4px, 0.22vw + 3px, 8px);
    font-family: "Space Grotesk", var(--font-ui);
    font-weight: 800;
    letter-spacing: 0.24em;
    background: var(--gradient-brand);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-transform: uppercase;
    transition: filter 160ms ease, opacity 160ms ease;

    &:hover {
      opacity: 0.9;
      filter: saturate(120%);
    }
  }

  &__brand-short {
    display: none;
    letter-spacing: 0.3em;
  }

  &__logo {
    color: var(--text-primary) !important;
    background: linear-gradient(140deg, rgba(84, 102, 170, 0.26), rgba(61, 218, 198, 0.12));
    border: 1px solid var(--border-subtle);
    -webkit-tap-highlight-color: transparent;

    &:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .header__logo-icon {
      font-size: clamp(24px, 0.78vw + 20px, 30px);
      color: var(--accent-strong);
      transition: transform 0.2s ease;
    }

    .header__logo-icon.is-open {
      transform: rotate(180deg);
    }
  }

  &__menu-desktop {
    display: flex;
    align-items: center;
    gap: clamp(6px, 0.22vw + 5px, 9px);

    .header__link {
      position: relative;
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--nav-link);
      text-transform: none;
      padding: clamp(7px, 0.2vw + 6px, 10px) clamp(10px, 0.3vw + 8px, 14px);
      border-radius: clamp(11px, 0.22vw + 10px, 14px);
      border: 1px solid transparent;
      transition: background-color 180ms ease, color 180ms ease, border-color 180ms ease;

      &:hover {
        color: var(--nav-link-active);
        border-color: var(--border-subtle);
        background: rgba(121, 140, 221, 0.12);
      }

      &:focus-visible {
        box-shadow: var(--focus-ring);
      }
    }
  }

  &__right {
    display: flex;
    align-items: center;
    gap: clamp(6px, 0.3vw + 5px, 10px);
  }

  &__assistant-btn {
    width: 32px;
    height: 32px;
    border-radius: 10px;
    border: 1px solid color-mix(in srgb, var(--brand-soft) 52%, var(--border-subtle));
    background: linear-gradient(
      145deg,
      color-mix(in srgb, var(--brand-soft) 24%, var(--surface-soft)),
      color-mix(in srgb, var(--brand-solid) 14%, var(--surface-soft))
    );
    color: var(--accent-text);
    box-shadow: 0 8px 16px color-mix(in srgb, var(--brand-solid) 24%, transparent);

    &:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px color-mix(in srgb, var(--brand-solid) 30%, transparent);
    }
  }

  &__assistant-pill {
    min-height: 32px;
    border-radius: 999px;
    border: 1px solid color-mix(in srgb, var(--brand-soft) 52%, var(--border-subtle));
    background:
      linear-gradient(
        132deg,
        color-mix(in srgb, var(--brand-soft) 24%, var(--surface-soft)) 0%,
        color-mix(in srgb, #38d3f3 22%, var(--surface-soft)) 100%
      );
    color: var(--text-primary);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.01em;
    cursor: pointer;
    position: relative;
    overflow: visible;
    box-shadow:
      0 8px 16px color-mix(in srgb, #1b2f64 24%, transparent),
      0 0 0 1px color-mix(in srgb, var(--brand-soft) 14%, transparent),
      0 0 20px color-mix(in srgb, var(--brand-soft) 18%, transparent);
    transition:
      border-color 160ms ease,
      background-color 160ms ease,
      transform 160ms ease;

    &:hover {
      border-color: color-mix(in srgb, var(--brand-solid) 58%, var(--border-strong));
      transform: translateY(-1px);
      box-shadow:
        0 10px 18px color-mix(in srgb, #1b2f64 28%, transparent),
        0 0 0 1px color-mix(in srgb, var(--brand-soft) 22%, transparent),
        0 0 26px color-mix(in srgb, #44d9f8 24%, transparent);
    }

    &.is-open {
      border-color: color-mix(in srgb, var(--brand-solid) 62%, var(--border-strong));
      background:
        linear-gradient(
          138deg,
          color-mix(in srgb, var(--brand-soft) 40%, var(--surface-soft)) 0%,
          color-mix(in srgb, #48ddf3 32%, var(--surface-soft)) 100%
        );
      color: var(--accent-text);
      box-shadow:
        0 12px 22px color-mix(in srgb, var(--brand-solid) 28%, transparent),
        0 0 28px color-mix(in srgb, #48dff8 28%, transparent);
    }

    &.is-thinking {
      border-color: color-mix(in srgb, #4ad8ff 58%, var(--border-strong));
      box-shadow:
        0 10px 18px color-mix(in srgb, #2ccde8 24%, transparent),
        0 0 0 1px color-mix(in srgb, #58d5ff 22%, transparent);
    }

    &.is-error {
      border-color: color-mix(in srgb, var(--feedback-danger) 64%, var(--border-strong));
      color: color-mix(in srgb, var(--feedback-danger) 74%, var(--text-primary));
    }

    &.is-compact {
      min-height: 30px;
      width: 30px;
      height: 30px;
      border-radius: 10px;
      padding: 0;
      justify-content: center;
    }

    .MuiSvgIcon-root {
      font-size: 16px;
    }

    &::before,
    &::after {
      content: "";
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: radial-gradient(circle, #ffffff 0%, color-mix(in srgb, var(--brand-soft) 72%, transparent) 70%, transparent 100%);
      pointer-events: none;
      opacity: 0.78;
    }

    .MuiSvgIcon-root {
      filter: drop-shadow(0 0 7px color-mix(in srgb, #61e4ff 46%, transparent));
    }

    animation: header-assistant-pulse 2.6s ease-in-out infinite;

    &::before {
      top: -3px;
      right: 8px;
      animation: header-assistant-sparkle 2.4s ease-in-out infinite;
    }

    &::after {
      bottom: -2px;
      left: 10px;
      animation: header-assistant-sparkle 2.4s ease-in-out infinite 1.1s;
    }
  }

  &__theme-toggle {
    border: none !important;
    background: transparent !important;
    -webkit-tap-highlight-color: transparent;

    &:hover {
      box-shadow: none !important;
      transform: translateY(-1px);
    }
  }

  &__profile-btn {
    display: flex;
    align-items: center;
    gap: clamp(6px, 0.35vw + 5px, 10px);
    text-transform: none;
    background: linear-gradient(150deg, rgba(66, 85, 141, 0.32), rgba(35, 50, 92, 0.42));
    border-radius: clamp(10px, 0.3vw + 8px, 14px);
    padding: clamp(5px, 0.24vw + 4px, 8px) clamp(8px, 0.44vw + 7px, 14px);
    border: 1px solid var(--border-subtle);
    color: var(--text-primary) !important;
    font-weight: 600;
    box-shadow: var(--shadow-sm);

    &:hover {
      border-color: var(--border-strong);
      box-shadow: var(--shadow-glow);
      background: linear-gradient(150deg, rgba(80, 99, 159, 0.34), rgba(45, 63, 111, 0.48));
    }

    .header__avatar {
      width: clamp(26px, 0.26vw + 24px, 32px);
      height: clamp(26px, 0.26vw + 24px, 32px);
      border-radius: 50%;
      background: var(--gradient-brand);
      color: var(--text-on-brand);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-sm);
      font-weight: 700;
      box-shadow: 0 6px 14px rgba(99, 115, 255, 0.28);
    }
  }

  &__menu-mobile {
    display: none;
    position: relative;
    z-index: 121;
    margin-top: clamp(8px, 0.32vw + 6px, 12px);
    padding: clamp(10px, 0.36vw + 8px, 14px);
    border-radius: clamp(12px, 0.3vw + 10px, 16px);
    flex-direction: column;
    gap: 10px;
    background: var(--surface-glass);
    border: none;
    box-shadow: var(--shadow-md);

    .header__mobile-item {
      justify-content: flex-start;
      text-transform: none;
      font-weight: 600;
      border-radius: 14px;
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      background: rgba(81, 99, 161, 0.15);

      &:hover {
        border-color: var(--border-strong);
        background: rgba(96, 118, 187, 0.22);
      }

      -webkit-tap-highlight-color: transparent;
    }
  }

  &__mobile-backdrop {
    position: fixed;
    inset: 0;
    z-index: 120;
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    -webkit-tap-highlight-color: transparent;
  }

  @media (max-width: 1024px) {
    padding: clamp(8px, 0.42vw + 6px, 12px) var(--layout-gutter);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;

    &__menu-desktop {
      display: none;
    }

    &__menu-mobile {
      display: flex;
    }

    &__brand-full {
      display: none;
    }

    &__brand-short {
      display: inline-flex;
    }

    &__profile-btn {
      padding: 5px 7px;
      background: transparent;
      box-shadow: none;
      border: none;
    }

    &__assistant-btn {
      width: 30px;
      height: 30px;
    }

    &__assistant-pill {
      min-height: 30px;
      width: 30px;
      height: 30px;
      border-radius: 10px;
      padding: 0;
      justify-content: center;
      box-shadow: 0 8px 16px color-mix(in srgb, var(--brand-solid) 22%, transparent);
    }

    &__profile-name {
      display: none;
    }

    &__mobile-backdrop {
      inset: 58px 0 0;
    }
  }
}

@keyframes header-assistant-sparkle {
  0%,
  100% {
    opacity: 0.24;
    transform: scale(0.78);
  }
  45% {
    opacity: 0.92;
    transform: scale(1.24);
  }
}

@keyframes header-assistant-pulse {
  0%,
  100% {
    box-shadow:
      0 8px 16px color-mix(in srgb, #1b2f64 24%, transparent),
      0 0 0 1px color-mix(in srgb, var(--brand-soft) 14%, transparent),
      0 0 20px color-mix(in srgb, var(--brand-soft) 18%, transparent);
  }

  50% {
    box-shadow:
      0 10px 20px color-mix(in srgb, #1b2f64 30%, transparent),
      0 0 0 1px color-mix(in srgb, var(--brand-soft) 24%, transparent),
      0 0 30px color-mix(in srgb, #45dff8 28%, transparent);
  }
}
